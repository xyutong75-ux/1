{% extends "base.html" %}
{% block title %}{{ album.title }} - 专辑{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <div>
            <div class="card-title">{{ album.title }}</div>
            <div class="card-subtitle">
                作者：
                <a href="{{ url_for('author_detail', author_id=album.author.id) }}">
                    {{ album.author.pen_name }}
                </a>
            </div>
        </div>
    </div>

    {% if album.description %}
    <p class="meta-text" style="margin-top:4px;">{{ album.description }}</p>
    {% endif %}

    {# 只有作者本人登录时，显示“添加笔记”表单 #}
    {% if user and user.is_author() and album.author.user_id == user.id %}
    <hr style="margin:12px 0; border:none; border-top:1px solid #eee;">
    <h4 style="font-size:15px; margin-bottom:6px;">在本专辑中添加笔记</h4>
    <form method="post" action="{{ url_for('create_note') }}">
        <div class="form-group">
            <label class="form-label">笔记内容</label>
            <textarea class="form-control" name="content" rows="3" placeholder="写下你对本专辑的想法或创作笔记..."></textarea>
        </div>
        <input type="hidden" name="album_id" value="{{ album.id }}">
        <button type="submit" class="btn btn-primary">保存笔记</button>
    </form>
    {% endif %}

    <hr style="margin:16px 0; border:none; border-top:1px solid #eee;">

    <h4 style="font-size:15px; margin-top:4px;">专辑笔记</h4>
    <ul style="list-style:none; padding-left:0; margin-top:6px;">
        {% for note in album.notes %}
        <li style="margin-bottom:8px;">
            <div style="font-size:14px; line-height:1.5; white-space:pre-wrap;">
                {{ note.content }}
            </div>
            <div class="meta-text">
                {{ note.created_at.strftime('%Y-%m-%d %H:%M') if note.created_at }}
            </div>
        </li>
        {% else %}
        <li class="meta-text">该专辑还没有笔记。</li>
        {% endfor %}
    </ul>
</div>
{% endblock %}
