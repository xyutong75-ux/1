【夜读小说网站 - 操作说明】

一、管理员账号与登录
--------------------

1. 默认管理员账号在 app.py 的 init_db() 中自动创建：
   - 用户名：admin
   - 密码：123456（全数字）

2. 启动网站后，在浏览器中访问：
   http://127.0.0.1:5000/login

3. 用 admin / 123456 登录后，右上角会出现“管理”按钮，
   点击进入管理员后台。


二、用户角色说明
----------------

1. 读者（reader）
   - 可以浏览书籍、章节
   - 可以收藏书籍
   - 可以在「设置」页面查看当前账号信息

2. 作者（author）
   - 同时也是读者
   - 拥有作者后台（作者 UI）
   - 可以创建新书、新专辑
   - 可以直接在网页内写入书籍内容（章节）和专辑内的笔记
   - 可以删除自己书籍中的章节、自己的笔记

3. 管理员（admin）
   - 账号唯一（默认 admin）
   - 可以访问管理员后台
   - 可以导出访问数据（专辑在某段时间内的访问情况）
   - 如有需要，可以在数据库中修改用户角色（例如把某个用户改为 author）


三、如何导入书籍与章节
-----------------------

1. 作为作者使用网页导入（推荐方式）：

   步骤：
   (1) 注册新账号：
       - 打开“注册”页面（右上角按钮）
       - 填写用户名、密码
       - 角色选择“作者（author）”
       - 注册完成后，用该账号登录

   (2) 打开作者 UI：
       - 登录后，点击顶部“设置”
       - 在“显示作者界面”开关处打开
       - 返回首页，可看到右上角出现“作者后台”按钮

   (3) 进入作者后台：
       - 点击“作者后台”
       - 在“新建书籍”区域填写书名和简介，点击“创建书籍”
       - 创建成功后，页面下方“当前书籍”会显示新书及其 ID

   (4) 为书添加章节：
       - 在首页或作者后台点击书名进入书籍详情页
       - 书籍详情页底部有“作者快速新增章节”表单
       - 填写章节标题、内容，提交即可
       - 章节会按 order_index 顺序排列，章节页面底部自动显示上一章/下一章跳转

   (5) 创建专辑与笔记：
       - 在“作者后台”的“新建专辑”区填写专辑名称和说明，点击“创建专辑”
       - “写笔记”区域可以选填 book_id 或 album_id，把笔记关联到某本书或某个专辑


2. 通过数据库导入大批量文本（进阶方式）：

   （需要一定 SQL / Python 能力）

   方案举例：
   - 先用作者后台创建书和专辑，确定它们的 ID；
   - 用 Python 脚本或 SQLite 工具，批量往 Chapter 表中插入数据：
     - 必填字段：title, content, order_index, book_id
   - 插入完成后，重启网站，即可在前端看到所有章节。

   注意：
   - order_index 决定章节顺序，数字越小越靠前。
   - 请保证同一本书内的 order_index 连续（1, 2, 3, ...）更直观。


四、如何删除书、专辑、作者等
-----------------------------

当前版本已经提供：

1. 删除章节（由作者执行）
   - 作为作者登录；
   - 进入某章节页面底部，会看到“删除本章节”按钮；
   - 点击后，该章节从数据库中删除。

2. 删除笔记（由作者执行）
   - 进入“作者后台”；
   - 当前 UI 已提供新增笔记功能；
   - 删除笔记接口在 app.py 中为：
     /author/note/<note_id>/delete  （POST）
   - 你可以在作者后台为每条笔记加一个“删除”按钮，指向这个接口；
   - 只有笔记所属书/专辑的作者可以删除自己的笔记。

3. 删除书、专辑、作者（后台操作建议）：

   为了避免误删，这一版只在后端预留了关系（级联删除），
   实际按钮可以按需要后续添加：

   - 删除 Book：
     - 通过管理工具（如 SQLite 浏览器）或单独写 Flask 接口，
       删除 Book 记录；
     - 由于模型中设置了 cascade="all, delete-orphan"，
       该书下的 Chapter、Note 会自动一起删除。

   - 删除 Album：
     - 同理，删除 Album 记录；
     - 该专辑下的 Note 和 VisitLog 会被一起删除。

   - 删除 Author：
     - 一般不推荐直接删作者；
     - 若确实需要，可以先把该作者名下书和专辑清理，再删除 Author 记录；
     - 与该 Author 关联的 User 可以保留为 reader，或者按照需要删除。

   若你希望所有这些操作也在网页上完成，可以新增类似的管理页面：
   - /admin/books         查看 & 删除书
   - /admin/albums        查看 & 删除专辑
   - /admin/authors       查看 & 删除作者
   （所有接口前加上 @admin_required 装饰器）


五、管理员导出访问数据
-----------------------

1. 登录管理员账号：admin / 123456
2. 点击顶部“管理”进入管理员后台
3. 点击“导出访问数据”菜单（/admin/export）
4. 在页面上：
   - 选择一个专辑
   - 填写起始日期（start_date，YYYY-MM-DD，可空）
   - 填写结束日期（end_date，YYYY-MM-DD，可空）
   - 提交后，页面下方会显示一段 CSV 文本预览：

   字段说明：
   - album_id        专辑 ID
   - album_title     专辑名称
   - start_date      统计起始日期
   - end_date        统计结束日期
   - total_visits    总访问次数
   - unique_users    不同访问用户数（去掉作者账号信息，只计数）

5. 如果你希望导出为实际文件，可以新增一个下载接口，把这段 CSV 用 send_file 返回。


六、如何区分作者界面与读者界面
------------------------------

1. 普通读者登录：
   - 只会看到首页、搜索、收藏（读书）等界面；
   - “设置”页面显示为纯读者模式说明；
   - 不会显示“作者后台”按钮。

2. 作者登录但未打开作者 UI 开关：
   - 角色依然是 author；
   - “设置”页面可以看到“显示作者界面”的开关；
   - 但在首页顶部不会出现“作者后台”按钮；
   - 体验类似纯读者。

3. 作者登录并在设置中打开开关：
   - 顶部导航下方会出现“作者后台”按钮；
   - 可以进入作者后台进行：
     - 新建书籍
     - 新建专辑
     - 新建章节
     - 新建/删除笔记


七、后端文件简要说明
--------------------

1. app.py
   - 网站主入口，路由逻辑、登录、注册、作者/管理员后台逻辑都在这里。

2. models.py
   - 定义数据库表结构（User, Author, Album, Book, Chapter, Note, Favorite, VisitLog）。

3. config.py
   - 配置文件（SQLite 数据库路径、SECRET_KEY 等）。

4. templates/
   - 网站的所有页面 UI 模板，使用 Jinja2 渲染。

5. static/css/style.css
   - 自定义 iOS 风格界面，保证整体简洁、大气。

6. static/js/main.js
   - 预留前端脚本位置，目前可为空或后续添加交互效果。


【完】
